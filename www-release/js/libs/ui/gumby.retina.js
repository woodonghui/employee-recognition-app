!function(e){function t(t){Gumby.debug("Initializing Retina",t),this.$el=t,this.imageSrc=this.$el.attr("src"),this.retinaSrc=this.fetchRetinaImage(),this.$retinaImg=e(new Image);var n=this;if(!this.retinaSrc)return!1;this.$retinaImg.attr("src",this.retinaSrc).load(function(){n.retinaImageLoaded()}).error(function(){Gumby.error("Couln't load retina image: "+n.retinaSrc)})}t.prototype.fetchRetinaImage=function(){var e=this.imageSrc,t=this.imageSrc.search(/(\.|\/)(gif|jpe?g|png)$/i);return t<0?!1:e.substr(0,t)+"@2x"+e.substr(t,e.length)},t.prototype.retinaImageLoaded=function(){Gumby.debug("Swapping image for retina version",this.$el),Gumby.debug("Triggering onRetina event",this.$el),this.$el.attr("src",this.$retinaImg.attr("src")).trigger("gumby.onRetina")},Gumby.addInitalisation("retina",function(){if(!window.devicePixelRatio||window.devicePixelRatio<=1)return;e("img[data-retina],img[gumby-retina],img[retina]").each(function(){var n=e(this);if(n.data("isRetina"))return!0;n.data("isRetina",!0),new t(n)})}),Gumby.UIModule({module:"retina",events:["onRetina"],init:function(){Gumby.initialize("retina")}})}(jQuery);